<section>
    {{ partial:components/section/hero-section heading="Blogs" subtitle="Thoughts, tutorials, and insights on web
    development" show_recent_project="false" }}
</section>

{{ collection:blogs as="blogs_list" }}
{{ if blogs_list | length > 0 }}
<div id="blog-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 lg:gap-8 p-4 sm:p-6 lg:p-8 max-w-7xl mx-auto">
    {{ blogs_list limit="9" where="is_published:is:true" }}
    <a href="{{ url }}" class="blog-item flex flex-col gap-2 cursor-pointer group">
        <div class="w-full h-[200px] sm:h-[250px] md:h-[300px] rounded-md overflow-hidden">
            {{ if thumbnail }}
                <img src="{{ thumbnail }}" alt="{{ title }}" class="w-full h-full object-cover rounded-md transition-transform duration-300 group-hover:scale-105" />
            {{ else }}
                <div class="w-full h-full bg-gray-200 flex items-center justify-center">
                    <span class="text-gray-400 text-sm">No Image</span>
                </div>
            {{ /if }}
        </div>
        <h2 class="blog-title text-lg sm:text-xl font-semibold line-clamp-2">{{ title }}</h2>
        <p class="blog-description text-xs sm:text-sm text-gray-600 line-clamp-3">{{ excerpt | truncate:150:... }}</p>
    </a>
    {{ /blogs_list }}
</div>
{{ else }}
<div class="flex justify-center items-center p-16">
    <p class="text-2xl text-gray-400">No blogs available yet. Check back soon!</p>
</div>
{{ /if }}
{{ /collection:blogs }}

{{ collection:blogs where="is_published:is:true" as="all_blogs" }}
{{ if all_blogs | length > 9 }}
<div class="text-center p-4">
    <button id="load-more-btn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
        Load More
    </button>
</div>
{{ /if }}
{{ /collection:blogs }}

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const loadMoreBtn = document.getElementById('load-more-btn');
        const blogContainer = document.getElementById('blog-container');
        let currentOffset = 9; // Already loaded 9 blogs initially
        let isLoading = false;

        function createBlogItems(blogs) {
            const fragment = document.createDocumentFragment();

            blogs.forEach((blog) => {
                const blogLink = document.createElement('a');
                blogLink.href = blog.url;
                blogLink.className = 'blog-item flex flex-col gap-2 cursor-pointer group';

                blogLink.innerHTML = `
                <div class="w-full h-[300px] rounded-md overflow-hidden">
                    <img src="${blog.thumbnail}" alt="${blog.title}" class="w-full h-full object-cover rounded-md" />
                </div>
                <h2 class="blog-title text-xl font-semibold">${blog.title}</h2>
                <p class="blog-description text-sm text-gray-600">${blog.description}</p>
            `;

                fragment.appendChild(blogLink);
            });

            return fragment;
        }

        function loadMoreBlogs() {
            if (isLoading) return;

            isLoading = true;
            loadMoreBtn.textContent = 'Loading...';
            loadMoreBtn.disabled = true;

            fetch(`/api/blogs/load-more?offset=${currentOffset}`)
                .then(response => response.json())
                .then(data => {
                    const allBlogs = data.sections.flatMap(section => section.blogs);
                    const blogItems = createBlogItems(allBlogs);
                    blogContainer.appendChild(blogItems);

                    // Re-initialize animations for newly loaded blogs
                    if (window.initBlogIndexAnimation) {
                        window.initBlogIndexAnimation();
                    }

                    currentOffset += 9;

                    if (!data.hasMore) {
                        loadMoreBtn.style.display = 'none';
                    } else {
                        loadMoreBtn.textContent = 'Load More';
                        loadMoreBtn.disabled = false;
                    }

                    isLoading = false;
                })
                .catch(error => {
                    console.error('Error loading blogs:', error);
                    loadMoreBtn.textContent = 'Error - Try Again';
                    loadMoreBtn.disabled = false;
                    isLoading = false;
                });
        }

        loadMoreBtn.addEventListener('click', loadMoreBlogs);
    });
</script>